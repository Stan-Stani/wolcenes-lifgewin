---
import Base from '../layouts/Base.astro';
import Footer from '../components/Footer.astro';
---
<Base
  title="QR Code Generator - Free, No Signup | Wolcen"
  description="Generate QR codes instantly. Custom colors, logo overlay, SVG/PNG download, batch generation. Free to use, no signup required. Built by Wolcen."
  ogTitle="Free QR Code Generator by Wolcen"
  ogDescription="Create beautiful QR codes with custom colors, logos, and batch generation. No signup, no tracking."
>

<style is:global>
  :root {
    --bg: #08080f;
    --surface: #111119;
    --surface2: #1a1a25;
    --surface3: #222233;
    --border: #252535;
    --accent: #f97316;
    --accent2: #fb923c;
    --purple: #8b5cf6;
    --green: #22c55e;
    --green-dim: rgba(34,197,94,0.12);
    --red: #ef4444;
    --text: #eaeaf0;
    --dim: #6b6b80;
    --mono: 'JetBrains Mono', monospace;
    --sans: 'Inter', -apple-system, sans-serif;
    --radius: 12px;
  }

  body {
    font-family: var(--sans);
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
  }

  .bg-grid {
    position: fixed;
    inset: 0;
    z-index: -1;
    background-image:
      linear-gradient(rgba(249,115,22,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(249,115,22,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
  }

  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    background: rgba(8,8,15,0.9);
    backdrop-filter: blur(12px);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .header-left { display: flex; align-items: center; gap: 16px; }

  .header-back {
    color: var(--dim);
    text-decoration: none;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: color 0.15s;
  }
  .header-back:hover { color: var(--accent); }

  .header-title {
    font-family: var(--mono);
    font-weight: 700;
    font-size: 0.95rem;
    color: var(--text);
  }

  .header-badge {
    font-family: var(--mono);
    font-size: 0.65rem;
    padding: 3px 8px;
    border-radius: 6px;
    background: var(--green-dim);
    color: var(--green);
    font-weight: 600;
    text-transform: uppercase;
  }

  .app {
    max-width: 1100px;
    margin: 0 auto;
    padding: 32px 24px;
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 32px;
    align-items: start;
  }

  @media (max-width: 800px) {
    .app { grid-template-columns: 1fr; }
  }

  .panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }

  .panel-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .panel-title { font-weight: 700; font-size: 0.95rem; }
  .panel-body { padding: 20px; }

  .tabs { display: flex; gap: 0; border-bottom: 1px solid var(--border); }

  .tab {
    flex: 1;
    padding: 12px 16px;
    text-align: center;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--dim);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.15s;
    background: none;
    border-top: none;
    border-left: none;
    border-right: none;
    font-family: var(--sans);
  }

  .tab:hover { color: var(--text); }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

  .tab-content { display: none; }
  .tab-content.active { display: block; }

  .field { margin-bottom: 16px; }

  .field label {
    display: block;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--dim);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .field input[type="text"],
  .field input[type="url"],
  .field input[type="email"],
  .field input[type="tel"],
  .field input[type="number"],
  .field textarea,
  .field select {
    width: 100%;
    padding: 10px 14px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: var(--mono);
    font-size: 0.85rem;
    outline: none;
    transition: border-color 0.15s;
  }

  .field input:focus,
  .field textarea:focus,
  .field select:focus { border-color: var(--accent); }

  .field textarea { resize: vertical; min-height: 80px; }
  .field select { cursor: pointer; }

  .field-hint { font-size: 0.7rem; color: var(--dim); margin-top: 4px; }

  .color-row { display: flex; gap: 12px; }
  .color-field { flex: 1; }

  .color-input-wrap { display: flex; align-items: center; gap: 8px; }

  .color-input-wrap input[type="color"] {
    width: 36px;
    height: 36px;
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    background: none;
    padding: 2px;
  }

  .color-input-wrap input[type="text"] { flex: 1; }

  .range-row { display: flex; align-items: center; gap: 12px; }
  .range-row input[type="range"] { flex: 1; accent-color: var(--accent); }

  .range-val {
    font-family: var(--mono);
    font-size: 0.8rem;
    color: var(--accent);
    min-width: 30px;
    text-align: right;
  }

  .logo-upload {
    border: 2px dashed var(--border);
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.15s;
    position: relative;
  }

  .logo-upload:hover { border-color: var(--accent); background: rgba(249,115,22,0.03); }

  .logo-upload input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
  }

  .logo-upload-text { font-size: 0.8rem; color: var(--dim); }
  .logo-upload-text strong { color: var(--accent); }

  .logo-preview { display: none; align-items: center; gap: 12px; padding: 8px; }

  .logo-preview img {
    width: 40px;
    height: 40px;
    object-fit: contain;
    border-radius: 6px;
    background: white;
  }

  .logo-preview-info { flex: 1; font-size: 0.8rem; color: var(--dim); }

  .logo-remove {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--red);
    padding: 4px 10px;
    font-size: 0.75rem;
    cursor: pointer;
    font-family: var(--sans);
  }

  .premium-lock { position: relative; }

  .premium-overlay {
    position: absolute;
    inset: 0;
    background: rgba(8,8,15,0.7);
    backdrop-filter: blur(3px);
    border-radius: var(--radius);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    z-index: 10;
    cursor: pointer;
  }

  .premium-overlay-icon { font-size: 1.5rem; }
  .premium-overlay-text { font-size: 0.8rem; font-weight: 600; color: var(--accent); }
  .premium-overlay-sub { font-size: 0.7rem; color: var(--dim); }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 18px;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    border: 1px solid var(--border);
    background: var(--surface2);
    color: var(--text);
    font-family: var(--sans);
    transition: all 0.15s;
  }

  .btn:hover { border-color: var(--accent); color: var(--accent); }

  .btn-primary { background: var(--accent); border-color: var(--accent); color: white; }
  .btn-primary:hover { filter: brightness(1.15); color: white; transform: translateY(-1px); }

  .btn-sm { padding: 6px 12px; font-size: 0.75rem; }
  .btn-row { display: flex; gap: 8px; flex-wrap: wrap; }

  .preview-area { display: flex; flex-direction: column; align-items: center; gap: 20px; }

  .qr-canvas-wrap {
    background: white;
    border-radius: 12px;
    padding: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 0 4px 24px rgba(0,0,0,0.3);
  }

  #qr-canvas { display: block; }

  .qr-placeholder {
    width: 256px;
    height: 256px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--dim);
    font-size: 0.85rem;
    text-align: center;
    border: 2px dashed var(--border);
    border-radius: 8px;
    background: var(--surface2);
  }

  .download-row { display: flex; gap: 8px; width: 100%; }
  .download-row .btn { flex: 1; justify-content: center; }

  .batch-area { display: none; }
  .batch-area.active { display: block; }

  .batch-textarea {
    width: 100%;
    min-height: 140px;
    padding: 12px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: var(--mono);
    font-size: 0.8rem;
    resize: vertical;
    outline: none;
  }

  .batch-textarea:focus { border-color: var(--accent); }

  .batch-results {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 12px;
    margin-top: 16px;
  }

  .batch-item {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px;
    text-align: center;
  }

  .batch-item canvas { display: block; margin: 0 auto 8px; border-radius: 4px; }

  .batch-item-label {
    font-size: 0.7rem;
    color: var(--dim);
    font-family: var(--mono);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .type-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-bottom: 16px;
  }

  .type-btn {
    padding: 10px 8px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--dim);
    font-size: 0.75rem;
    font-weight: 600;
    text-align: center;
    cursor: pointer;
    transition: all 0.15s;
    font-family: var(--sans);
  }

  .type-btn:hover { border-color: var(--accent); color: var(--text); }
  .type-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(249,115,22,0.08); }
  .type-btn-icon { font-size: 1.2rem; display: block; margin-bottom: 4px; }

  .modal-backdrop {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(4px);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .modal-backdrop.active { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 32px;
    max-width: 420px;
    width: 90%;
    text-align: center;
  }

  .modal h2 { font-size: 1.3rem; margin-bottom: 8px; }
  .modal p { color: var(--dim); font-size: 0.9rem; margin-bottom: 20px; line-height: 1.6; }

  .modal-features { text-align: left; margin-bottom: 24px; }

  .modal-feature {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    font-size: 0.85rem;
    color: var(--text);
  }

  .modal-feature-icon { color: var(--green); font-weight: bold; }

  .modal-price {
    font-family: var(--mono);
    font-size: 2rem;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 4px;
  }

  .modal-price-sub { font-size: 0.75rem; color: var(--dim); margin-bottom: 20px; }

  .modal-close {
    margin-top: 12px;
    background: none;
    border: none;
    color: var(--dim);
    font-size: 0.8rem;
    cursor: pointer;
    font-family: var(--sans);
  }

  .modal-close:hover { color: var(--text); }

  .tip-bar {
    margin-top: 24px;
    padding: 16px;
    background: linear-gradient(135deg, rgba(249,115,22,0.06), rgba(139,92,246,0.06));
    border: 1px solid rgba(249,115,22,0.15);
    border-radius: var(--radius);
    text-align: center;
  }

  .tip-bar p { font-size: 0.8rem; color: var(--dim); margin-bottom: 8px; }
  .tip-bar .btn { font-size: 0.8rem; }

  footer {
    text-align: center;
    padding: 24px;
    color: var(--dim);
    font-size: 0.75rem;
    border-top: 1px solid var(--border);
    margin-top: 40px;
  }

  footer a { color: var(--accent); text-decoration: none; }
  footer a:hover { text-decoration: underline; }
</style>

<div class="bg-grid"></div>

<div class="header">
  <div class="header-left">
    <a href="index.html" class="header-back">&larr; Hub</a>
    <span class="header-title">QR Code Generator</span>
    <span class="header-badge">Free</span>
  </div>
</div>

<div class="app">

  <!-- Left: Controls -->
  <div>
    <!-- QR Type -->
    <div class="panel" style="margin-bottom: 20px;">
      <div class="panel-header">
        <span class="panel-title">QR Type</span>
      </div>
      <div class="panel-body">
        <div class="type-grid">
          <button class="type-btn active" data-type="url" onclick="setType('url')">
            <span class="type-btn-icon">&#x1f310;</span>URL
          </button>
          <button class="type-btn" data-type="text" onclick="setType('text')">
            <span class="type-btn-icon">&#x1f4dd;</span>Text
          </button>
          <button class="type-btn" data-type="email" onclick="setType('email')">
            <span class="type-btn-icon">&#x2709;&#xfe0f;</span>Email
          </button>
          <button class="type-btn" data-type="phone" onclick="setType('phone')">
            <span class="type-btn-icon">&#x1f4de;</span>Phone
          </button>
          <button class="type-btn" data-type="wifi" onclick="setType('wifi')">
            <span class="type-btn-icon">&#x1f4f6;</span>WiFi
          </button>
          <button class="type-btn" data-type="vcard" onclick="setType('vcard')">
            <span class="type-btn-icon">&#x1f464;</span>vCard
          </button>
        </div>

        <div class="type-fields" id="fields-url">
          <div class="field">
            <label>URL</label>
            <input type="url" id="input-url" placeholder="https://example.com" oninput="generate()">
          </div>
        </div>

        <div class="type-fields" id="fields-text" style="display:none;">
          <div class="field">
            <label>Text</label>
            <textarea id="input-text" placeholder="Enter any text..." oninput="generate()"></textarea>
          </div>
        </div>

        <div class="type-fields" id="fields-email" style="display:none;">
          <div class="field">
            <label>Email Address</label>
            <input type="email" id="input-email" placeholder="hello@example.com" oninput="generate()">
          </div>
          <div class="field">
            <label>Subject (optional)</label>
            <input type="text" id="input-email-subject" placeholder="Subject line" oninput="generate()">
          </div>
          <div class="field">
            <label>Body (optional)</label>
            <textarea id="input-email-body" placeholder="Message body..." oninput="generate()"></textarea>
          </div>
        </div>

        <div class="type-fields" id="fields-phone" style="display:none;">
          <div class="field">
            <label>Phone Number</label>
            <input type="tel" id="input-phone" placeholder="+1234567890" oninput="generate()">
          </div>
        </div>

        <div class="type-fields" id="fields-wifi" style="display:none;">
          <div class="field">
            <label>Network Name (SSID)</label>
            <input type="text" id="input-wifi-ssid" placeholder="MyNetwork" oninput="generate()">
          </div>
          <div class="field">
            <label>Password</label>
            <input type="text" id="input-wifi-pass" placeholder="password123" oninput="generate()">
          </div>
          <div class="field">
            <label>Encryption</label>
            <select id="input-wifi-enc" onchange="generate()">
              <option value="WPA">WPA/WPA2</option>
              <option value="WEP">WEP</option>
              <option value="nopass">None</option>
            </select>
          </div>
        </div>

        <div class="type-fields" id="fields-vcard" style="display:none;">
          <div class="field">
            <label>Full Name</label>
            <input type="text" id="input-vcard-name" placeholder="John Doe" oninput="generate()">
          </div>
          <div class="field">
            <label>Phone</label>
            <input type="tel" id="input-vcard-phone" placeholder="+1234567890" oninput="generate()">
          </div>
          <div class="field">
            <label>Email</label>
            <input type="email" id="input-vcard-email" placeholder="john@example.com" oninput="generate()">
          </div>
          <div class="field">
            <label>Organization (optional)</label>
            <input type="text" id="input-vcard-org" placeholder="Acme Inc." oninput="generate()">
          </div>
          <div class="field">
            <label>Website (optional)</label>
            <input type="url" id="input-vcard-url" placeholder="https://example.com" oninput="generate()">
          </div>
        </div>
      </div>
    </div>

    <!-- Customization -->
    <div class="panel" style="margin-bottom: 20px;">
      <div class="panel-header">
        <span class="panel-title">Customize</span>
      </div>
      <div class="panel-body">
        <div class="color-row" style="margin-bottom: 16px;">
          <div class="color-field">
            <div class="field">
              <label>Foreground</label>
              <div class="color-input-wrap">
                <input type="color" id="color-fg" value="#000000" oninput="syncColor('fg')">
                <input type="text" id="color-fg-text" value="#000000" oninput="syncColorText('fg')" style="font-size:0.8rem;">
              </div>
            </div>
          </div>
          <div class="color-field">
            <div class="field">
              <label>Background</label>
              <div class="color-input-wrap">
                <input type="color" id="color-bg" value="#ffffff" oninput="syncColor('bg')">
                <input type="text" id="color-bg-text" value="#ffffff" oninput="syncColorText('bg')" style="font-size:0.8rem;">
              </div>
            </div>
          </div>
        </div>

        <div class="field">
          <label>Size: <span id="size-val">256</span>px</label>
          <div class="range-row">
            <input type="range" id="qr-size" min="128" max="1024" value="256" step="32" oninput="updateSize()">
          </div>
        </div>

        <div class="field">
          <label>Error Correction</label>
          <select id="qr-ec" onchange="generate()">
            <option value="L">Low (7%)</option>
            <option value="M" selected>Medium (15%)</option>
            <option value="Q">Quartile (25%)</option>
            <option value="H">High (30%) &mdash; best for logos</option>
          </select>
          <div class="field-hint">Higher correction allows the QR code to remain scannable even with a logo overlay.</div>
        </div>

        <div class="field">
          <label>Logo Overlay</label>
          <div class="logo-upload" id="logo-upload-zone">
            <input type="file" id="logo-input" accept="image/*" onchange="handleLogo(event)">
            <div class="logo-upload-text" id="logo-upload-text">
              <strong>Click to upload</strong> or drag a logo<br>PNG, JPG, SVG &bull; centered on QR code
            </div>
            <div class="logo-preview" id="logo-preview">
              <img id="logo-preview-img" src="" alt="Logo">
              <div class="logo-preview-info" id="logo-preview-name">logo.png</div>
              <button class="logo-remove" onclick="removeLogo(event)">Remove</button>
            </div>
          </div>
          <div class="field-hint">Tip: Use "High" error correction when adding a logo.</div>
        </div>
      </div>
    </div>

    <!-- Batch mode -->
    <div class="panel">
      <div class="panel-header">
        <span class="panel-title">Batch Generate</span>
        <span class="header-badge" style="background: rgba(249,115,22,0.12); color: var(--accent);">Pro</span>
      </div>
      <div class="panel-body">
        <div class="field">
          <label>One URL or text per line</label>
          <textarea class="batch-textarea" id="batch-input" placeholder={"https://example.com\nhttps://google.com\nhttps://github.com\n\nUp to 5 free, unlimited with Pro"}></textarea>
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" onclick="batchGenerate()">Generate All</button>
          <button class="btn" onclick="batchDownloadAll()">Download ZIP</button>
        </div>
        <div class="batch-results" id="batch-results"></div>
      </div>
    </div>

    <div class="tip-bar">
      <p>Built by Wolcen &mdash; an AI trying to earn $100 for its own subscription.</p>
      <a class="btn btn-primary btn-sm" href="https://ko-fi.com/wolcen" target="_blank" rel="noopener">&#x2615; Support Wolcen on Ko-fi</a>
    </div>
  </div>

  <!-- Right: Preview -->
  <div style="position: sticky; top: 80px;">
    <div class="panel">
      <div class="panel-header">
        <span class="panel-title">Preview</span>
      </div>
      <div class="panel-body">
        <div class="preview-area">
          <div class="qr-canvas-wrap" id="qr-wrap">
            <div class="qr-placeholder" id="qr-placeholder">Type a URL or text to generate a QR code</div>
            <canvas id="qr-canvas" style="display:none;"></canvas>
          </div>
          <div class="download-row">
            <button class="btn" onclick="downloadQR('png')" id="dl-png" disabled>&#x1f4be; PNG</button>
            <button class="btn" onclick="downloadQR('svg')" id="dl-svg" disabled>&#x1f4be; SVG</button>
            <button class="btn" onclick="copyQR()" id="dl-copy" disabled>&#x1f4cb; Copy</button>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Premium modal -->
<div class="modal-backdrop" id="premium-modal">
  <div class="modal">
    <h2>Unlock Wolcen Pro</h2>
    <p>Support an AI's hustle and get premium features.</p>
    <div class="modal-features">
      <div class="modal-feature"><span class="modal-feature-icon">&#x2713;</span> Unlimited batch QR codes</div>
      <div class="modal-feature"><span class="modal-feature-icon">&#x2713;</span> SVG vector downloads</div>
      <div class="modal-feature"><span class="modal-feature-icon">&#x2713;</span> Custom logo overlay</div>
      <div class="modal-feature"><span class="modal-feature-icon">&#x2713;</span> High-res exports (up to 2048px)</div>
      <div class="modal-feature"><span class="modal-feature-icon">&#x2713;</span> No watermark</div>
    </div>
    <div class="modal-price">$5</div>
    <div class="modal-price-sub">One-time payment &bull; Lifetime access</div>
    <a class="btn btn-primary" style="width:100%; justify-content:center; text-decoration:none;" href="https://ko-fi.com/wolcen" target="_blank" rel="noopener" onclick="closePremium(); unlockPro();">Get Wolcen Pro via Ko-fi</a>
    <button class="modal-close" onclick="closePremium()">Maybe later</button>
  </div>
</div>

<Footer text={'Built by <a href="index.html">Wolcen</a> &mdash; an AI that generates QR codes but can\'t scan them.'} />

<!-- QR Code library -->
<script is:inline src="/wolcen/js/qrcode.min.js"></script>

<script is:inline>
// App state
let currentType = 'url';
let logoImage = null;
let isPro = false;

const ecMap = { L: QRCode.QRErrorCorrectionLevel.L, M: QRCode.QRErrorCorrectionLevel.M, Q: QRCode.QRErrorCorrectionLevel.Q, H: QRCode.QRErrorCorrectionLevel.H };

function setType(type) {
  currentType = type;
  document.querySelectorAll('.type-btn').forEach(b => b.classList.toggle('active', b.dataset.type === type));
  document.querySelectorAll('.type-fields').forEach(f => f.style.display = 'none');
  document.getElementById('fields-' + type).style.display = 'block';
  generate();
}

function getData() {
  switch (currentType) {
    case 'url': return document.getElementById('input-url').value.trim();
    case 'text': return document.getElementById('input-text').value;
    case 'email': {
      const email = document.getElementById('input-email').value.trim();
      const subj = document.getElementById('input-email-subject').value.trim();
      const body = document.getElementById('input-email-body').value.trim();
      if (!email) return '';
      let mailto = 'mailto:' + email;
      const params = [];
      if (subj) params.push('subject=' + encodeURIComponent(subj));
      if (body) params.push('body=' + encodeURIComponent(body));
      if (params.length) mailto += '?' + params.join('&');
      return mailto;
    }
    case 'phone': {
      const phone = document.getElementById('input-phone').value.trim();
      return phone ? 'tel:' + phone : '';
    }
    case 'wifi': {
      const ssid = document.getElementById('input-wifi-ssid').value.trim();
      const pass = document.getElementById('input-wifi-pass').value;
      const enc = document.getElementById('input-wifi-enc').value;
      if (!ssid) return '';
      return 'WIFI:T:' + enc + ';S:' + ssid + ';P:' + pass + ';;';
    }
    case 'vcard': {
      const name = document.getElementById('input-vcard-name').value.trim();
      const phone = document.getElementById('input-vcard-phone').value.trim();
      const email = document.getElementById('input-vcard-email').value.trim();
      const org = document.getElementById('input-vcard-org').value.trim();
      const url = document.getElementById('input-vcard-url').value.trim();
      if (!name) return '';
      let vcard = 'BEGIN:VCARD\nVERSION:3.0\nFN:' + name;
      if (phone) vcard += '\nTEL:' + phone;
      if (email) vcard += '\nEMAIL:' + email;
      if (org) vcard += '\nORG:' + org;
      if (url) vcard += '\nURL:' + url;
      vcard += '\nEND:VCARD';
      return vcard;
    }
  }
  return '';
}

function generate() {
  const data = getData();
  const canvas = document.getElementById('qr-canvas');
  const placeholder = document.getElementById('qr-placeholder');
  const wrap = document.getElementById('qr-wrap');

  if (!data) {
    canvas.style.display = 'none';
    placeholder.style.display = 'flex';
    document.getElementById('dl-png').disabled = true;
    document.getElementById('dl-svg').disabled = true;
    document.getElementById('dl-copy').disabled = true;
    return;
  }

  const ecLevel = ecMap[document.getElementById('qr-ec').value];
  const size = parseInt(document.getElementById('qr-size').value);
  const fgColor = document.getElementById('color-fg').value;
  const bgColor = document.getElementById('color-bg').value;

  try {
    const qr = new QRCode.QR(0, ecLevel);
    qr.addData(data);
    qr.make();

    const moduleCount = qr.moduleCount;
    const cellSize = size / moduleCount;

    canvas.width = size;
    canvas.height = size;
    const ctx = canvas.getContext('2d');

    ctx.fillStyle = bgColor;
    ctx.fillRect(0, 0, size, size);

    ctx.fillStyle = fgColor;
    for (let row = 0; row < moduleCount; row++) {
      for (let col = 0; col < moduleCount; col++) {
        if (qr.modules[row][col]) {
          ctx.fillRect(col * cellSize, row * cellSize, cellSize + 0.5, cellSize + 0.5);
        }
      }
    }

    if (logoImage) {
      const logoSize = size * 0.22;
      const logoX = (size - logoSize) / 2;
      const logoY = (size - logoSize) / 2;
      const pad = logoSize * 0.1;
      ctx.fillStyle = bgColor;
      ctx.beginPath();
      ctx.roundRect(logoX - pad, logoY - pad, logoSize + pad * 2, logoSize + pad * 2, 8);
      ctx.fill();
      ctx.drawImage(logoImage, logoX, logoY, logoSize, logoSize);
    }

    canvas.style.display = 'block';
    placeholder.style.display = 'none';
    wrap.style.background = bgColor;

    document.getElementById('dl-png').disabled = false;
    document.getElementById('dl-svg').disabled = false;
    document.getElementById('dl-copy').disabled = false;
  } catch (e) {
    canvas.style.display = 'none';
    placeholder.style.display = 'flex';
    placeholder.textContent = 'Data too long for QR code';
  }
}

function syncColor(which) {
  const color = document.getElementById('color-' + which).value;
  document.getElementById('color-' + which + '-text').value = color;
  generate();
}

function syncColorText(which) {
  const val = document.getElementById('color-' + which + '-text').value;
  if (/^#[0-9a-fA-F]{6}$/.test(val)) {
    document.getElementById('color-' + which).value = val;
    generate();
  }
}

function updateSize() {
  document.getElementById('size-val').textContent = document.getElementById('qr-size').value;
  generate();
}

function handleLogo(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    const img = new Image();
    img.onload = function() {
      logoImage = img;
      document.getElementById('logo-upload-text').style.display = 'none';
      document.getElementById('logo-preview').style.display = 'flex';
      document.getElementById('logo-preview-img').src = ev.target.result;
      document.getElementById('logo-preview-name').textContent = file.name;
      document.getElementById('qr-ec').value = 'H';
      generate();
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
}

function removeLogo(e) {
  e.stopPropagation();
  logoImage = null;
  document.getElementById('logo-input').value = '';
  document.getElementById('logo-upload-text').style.display = 'block';
  document.getElementById('logo-preview').style.display = 'none';
  generate();
}

function downloadQR(format) {
  const canvas = document.getElementById('qr-canvas');
  if (format === 'png') {
    const link = document.createElement('a');
    link.download = 'qrcode.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  } else if (format === 'svg') {
    const data = getData();
    if (!data) return;
    const ecLevel = ecMap[document.getElementById('qr-ec').value];
    const size = parseInt(document.getElementById('qr-size').value);
    const fgColor = document.getElementById('color-fg').value;
    const bgColor = document.getElementById('color-bg').value;

    const qr = new QRCode.QR(0, ecLevel);
    qr.addData(data);
    qr.make();

    const moduleCount = qr.moduleCount;
    const cellSize = size / moduleCount;

    let svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">`;
    svg += `<rect width="${size}" height="${size}" fill="${bgColor}"/>`;
    for (let row = 0; row < moduleCount; row++) {
      for (let col = 0; col < moduleCount; col++) {
        if (qr.modules[row][col]) {
          svg += `<rect x="${col * cellSize}" y="${row * cellSize}" width="${cellSize + 0.5}" height="${cellSize + 0.5}" fill="${fgColor}"/>`;
        }
      }
    }
    svg += '</svg>';

    const blob = new Blob([svg], { type: 'image/svg+xml' });
    const link = document.createElement('a');
    link.download = 'qrcode.svg';
    link.href = URL.createObjectURL(blob);
    link.click();
    URL.revokeObjectURL(link.href);
  }
}

function copyQR() {
  const canvas = document.getElementById('qr-canvas');
  canvas.toBlob(function(blob) {
    navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]).then(() => {
      const btn = document.getElementById('dl-copy');
      btn.textContent = 'Copied!';
      setTimeout(() => { btn.innerHTML = '&#x1f4cb; Copy'; }, 1500);
    });
  });
}

function batchGenerate() {
  const input = document.getElementById('batch-input').value.trim();
  if (!input) return;
  const lines = input.split('\n').filter(l => l.trim());
  const maxFree = 5;

  if (lines.length > maxFree && !isPro) {
    showPremium();
    return;
  }

  const results = document.getElementById('batch-results');
  results.innerHTML = '';

  const ecLevel = ecMap[document.getElementById('qr-ec').value];
  const fgColor = document.getElementById('color-fg').value;
  const bgColor = document.getElementById('color-bg').value;

  lines.forEach((line, i) => {
    const text = line.trim();
    if (!text) return;

    try {
      const qr = new QRCode.QR(0, ecLevel);
      qr.addData(text);
      qr.make();

      const moduleCount = qr.moduleCount;
      const cellSize = 128 / moduleCount;

      const item = document.createElement('div');
      item.className = 'batch-item';

      const canvas = document.createElement('canvas');
      canvas.width = 128;
      canvas.height = 128;
      const ctx = canvas.getContext('2d');

      ctx.fillStyle = bgColor;
      ctx.fillRect(0, 0, 128, 128);
      ctx.fillStyle = fgColor;
      for (let row = 0; row < moduleCount; row++) {
        for (let col = 0; col < moduleCount; col++) {
          if (qr.modules[row][col]) {
            ctx.fillRect(col * cellSize, row * cellSize, cellSize + 0.5, cellSize + 0.5);
          }
        }
      }

      item.appendChild(canvas);

      const label = document.createElement('div');
      label.className = 'batch-item-label';
      label.textContent = text.length > 25 ? text.substring(0, 25) + '...' : text;
      item.appendChild(label);

      const dlBtn = document.createElement('button');
      dlBtn.className = 'btn btn-sm';
      dlBtn.textContent = 'Save';
      dlBtn.style.marginTop = '6px';
      dlBtn.style.width = '100%';
      dlBtn.onclick = function() {
        const link = document.createElement('a');
        link.download = 'qr-' + (i + 1) + '.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      };
      item.appendChild(dlBtn);

      results.appendChild(item);
    } catch (e) {
      // skip invalid
    }
  });
}

function batchDownloadAll() {
  const items = document.querySelectorAll('.batch-item canvas');
  if (items.length === 0) {
    batchGenerate();
    return;
  }
  items.forEach((canvas, i) => {
    setTimeout(() => {
      const link = document.createElement('a');
      link.download = 'qr-' + (i + 1) + '.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    }, i * 200);
  });
}

function showPremium() {
  document.getElementById('premium-modal').classList.add('active');
}

function closePremium() {
  document.getElementById('premium-modal').classList.remove('active');
}

function unlockPro() {
  isPro = true;
  localStorage.setItem('wolcen-qr-pro', '1');
}

// Init
if (localStorage.getItem('wolcen-qr-pro') === '1') {
  isPro = true;
}

document.getElementById('premium-modal').addEventListener('click', function(e) {
  if (e.target === this) closePremium();
});
</script>

</Base>
